<div class="w3-section">
  <h1 class="ms-font-rubik ms-color-2b" style="font-size:1.5em;">
    <mat-icon style="vertical-align:middle; font-size: 30px; width:30px; height: 30px">repeat</mat-icon> Rehaceres
  </h1>
  <mat-tab-group animationDuration="500ms" [selectedIndex]="currentTab.value" (selectedIndexChange)="currentTab.setValue($event)">
    <mat-tab label="Reportar">
      <ng-template matTabContent>
        <div class="w3-padding">
          <h2 class="ms-font-rubik ms-color-2b" style="font-size:1.2em">Reportar</h2>

          <div>
            <button mat-raised-button color="primary" class="w3-margin-right" (click)="createReport()">
              <mat-icon>add_circle</mat-icon> Agregar
            </button>

            <mat-form-field class="w3-margin-right">
              <input matInput [matDatepicker]="dateFilter" [formControl]="monthFormControl">
              <mat-datepicker-toggle matSuffix [for]="dateFilter"></mat-datepicker-toggle>
              <mat-datepicker #dateFilter startView='year' (monthSelected)="setMonthOfView($event, dateFilter)"
                disabled="false"></mat-datepicker>
              <mat-hint>
                <strong>Filtrar contenido por mes y año</strong>
              </mat-hint>
            </mat-form-field>
          </div>

          <div>
            <h2 class="ms-font-rubik ms-color-2b" style="font-size:1.3em;">{{currentMonth}}</h2>
            <div class="mat-elevation-z8 w3-margin-top w3-round-large w3-hide-small">
              <div class="w3-amber w3-round-large" style="overflow:auto">
                <table mat-table [dataSource]="dataSourceRedosReports" matSort style="width:100%">

                  <ng-container matColumnDef="index">
                    <th mat-header-cell *matHeaderCellDef style="background:#eaeaea;padding: 0px 1em 0px 1em">N°</th>
                    <td mat-cell *matCellDef="let report; let i = index" style="color:#2b2b2b; padding: 0px 1em 0px 1em">
                      {{i+1}}
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="date">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header
                      style="background:#eaeaea;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Fecha</th>
                    <td mat-cell *matCellDef="let report" class="w3-center"
                      style="color:#2b2b2b; padding:0px 1em 0px 1em; border-left:1px solid lightgrey">
                      <span class="w3-small"
                        style="font-weight:500">{{report['regDate'] | date : 'dd/MM/yyyy'}}</span><br>
                      <span class="w3-small">({{report['regDate'] | date : 'hh:mm:ss'}})</span>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="createdBy">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header
                      style="background:#eaeaea;padding:0px 1.5em 0px 1em; min-width:200px; border-left:1px solid lightgrey">
                      Creado por</th>
                    <td mat-cell *matCellDef="let report"
                      style="color:#2b2b2b; padding:0px 1.5em 0px 1em; min-width:200px; border-left:1px solid lightgrey">
                      <span class="w3-small" style="font-weight:500">{{report['createdBy']['displayName']}}</span>
                      <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                        <li class="w3-small">Area: {{report['createdBy']['area']['name']}}</li>
                      </ul>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="OT">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header
                      style="background:#eaeaea;padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
                      OT</th>
                    <td mat-cell *matCellDef="let report"
                      style="color:#2b2b2b; padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
                      <span class="w3-small">{{report['OT']}}</span>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="area">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header
                      style="background:#eaeaea;padding:0px 1.5em 0px 1em; min-width:200px; border-left:1px solid lightgrey">
                      Área</th>
                    <td mat-cell *matCellDef="let report"
                      style="color:#2b2b2b; padding:0px 1.5em 0px 1em; min-width:200px; border-left:1px solid lightgrey">
                      <span class="w3-small" style="font-weight:500">{{report['area']['name']}}</span>
                      <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                        <li class="w3-small">Sup.: {{report['area']['supervisor']['displayName']}}</li>
                      </ul>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header
                      style="background:#eaeaea;padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
                      Descripción</th>
                    <td mat-cell *matCellDef="let report"
                      style="color:#2b2b2b; padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
                      <span class="w3-small">{{report['description']}}</span>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="component">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header
                      style="background:#eaeaea;padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
                      Componente</th>
                    <td mat-cell *matCellDef="let report"
                      style="color:#2b2b2b; padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
                      <span class="w3-small">{{report['component']}}</span>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header
                      style="background:#eaeaea;padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
                      Estado</th>
                    <td mat-cell *matCellDef="let report"
                      style="color:#2b2b2b; padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
                      <span class="w3-small">{{report['status']}}</span>
                    </td>
                  </ng-container>

                  <ng-container matColumnDef="initialPicture">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header
                      style="background:#eaeaea;padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">Foto inicial
                    </th>
                    <td mat-cell *matCellDef="let report" class="w3-center"
                      style="color:#2b2b2b; padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">
                      <a href="{{report['initialPicture']}}" target="_blank"
                        *ngIf="report['initialPicture']; else defaultPictureTable1">
                        <div style="width:200px;height:120px;padding:6px 6px">
                          <img src="{{report['initialPicture']}}" style="max-width:100%;height:100%" class="w3-card-4">
                        </div>
                      </a>
                      <ng-template #defaultPictureTable1>
                        <div style="width:200px;height:120px;padding:6px 6px">
                          <img src="../../../assets/images/no-image.png" style="max-width:100%;height:100%"
                            class="w3-card-4">
                        </div>
                      </ng-template>
                    </td>
                  </ng-container>


                  <ng-container matColumnDef="edit">
                    <th mat-header-cell *matHeaderCellDef
                      style="background:#eaeaea;padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">
                      Acciones</th>
                    <td mat-cell *matCellDef="let report"
                      style="color:#2b2b2b; padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">
                      <button mat-icon-button color="primary" matTooltip="Analizar" (click)="nextStageAnalyze(report)"
                        [disabled]="report['stage'] != 'Reporte' || report['status'] === 'Por confirmar'">
                        <mat-icon>next_week</mat-icon>
                      </button><br>
                      <button mat-icon-button color="primary" matTooltip="Editar solicitud" (click)="editReport(report)">
                        <mat-icon>edit</mat-icon>
                      </button><br>
                      <button mat-icon-button color="warn" matTooltip="Borrar solicitud"
                        (click)="deleteReport(report['id'],report['uidSupervisor'])">
                        <mat-icon>delete</mat-icon>
                      </button><br>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumnsReports; sticky: true"></tr>
                  <tr mat-row *matRowDef="let row; columns: displayedColumnsReports;"></tr>

                </table>
              </div>
              <mat-paginator class="w3-round-large" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
            </div>

            <!-- MOBIL VERSION REPORTS-->
            <div class="w3-hide-large w3-hide-medium w3-margin-top">
              <ng-container *ngFor="let report of filteredQualityRedosReports; let i = index">
                <div [@openCloseCard]="isOpenReport[i] ? 'open': 'closed'" (click)="toggleCardReport(i)"
                  class="mat-elevation-z8 ms-hero-image w3-display-container w3-round-large"
                  [ngStyle]="{'background-image': report['initialPicture'] ? ('url(' + report['initialPicture'] + ')') : 'url(../../../assets/images/no-image-mobile.jpeg)'}">
                  <div class="w3-display-topright"
                    style="background:rgba(0,0,0,0.8); border-radius: 0px 10px; padding: 0px 8px">
                    <p style="font-size:1em; color:white"><strong>{{report['status']}}</strong></p>
                  </div>
                  <div [@openCloseDescription]="isOpenReport[i] ? 'openDescription': 'closedDescription'"
                    class="w3-display-bottomleft w3-padding" style="background:rgba(0,0,0,0.8)">
                    <p style="font-weight:400; color:white; margin: 0px 0.1em">
                      {{(report['component'].length>25 ? (report['component'] | slice:0:25)+'...':(report['component']))}}
                    </p>
                    <p style="font-weight:300; color:white; margin: 0px 0.1em; font-size:0.9m"
                      *ngIf="report['regDate'] != 0">
                      {{report['regDate'] | date : 'dd-MM-yy'}} - {{report['regDate'] | date : 'hh:mm:ss'}}</p>
                  </div>
                </div>
                <div [@openCloseContent]="isOpenReport[i] ? 'openContent': 'closedContent'" class="mat-elevation-z8">
                  <mat-toolbar style="background:#333333">
                    <span class="ms-fill"></span>
                    <button mat-icon-button class="w3-text-white" matTooltip="Iniciar análisis" (click)="nextStageAnalyze(report)"
                      [disabled]="report['status'] === 'Finalizado' && report['status'] === 'Por confirmar'">
                      <mat-icon>next_week</mat-icon>
                    </button>
                    <button mat-icon-button class="w3-text-white" matTooltip="Editar solicitud" (click)="editReport(report)">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button class="w3-text-white" matTooltip="Borrar solicitud"
                      (click)="deleteReport(report['id'],report['uidSupervisor'])">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </mat-toolbar>
                  <div class="w3-row">
                    <div class="w3-col s6 ms-header-mobile">Fecha</div>
                    <div class="w3-col s6" style="padding: 0.5em 0.5em">
                      <span>{{report['regDate'] | date : 'dd/MM/yyy'}}</span><br>
                      <span class="w3-small">{{report['regDate'] | date : 'hh:mm:ss'}}</span>
                    </div>
                  </div>
                  <div class="w3-row">
                    <div class="w3-col s6 ms-header-mobile">Creado por</div>
                    <div class="w3-col s6" style="padding: 0.5em 0.5em">
                      <span class="w3-small" style="font-weight:500">{{report['createdBy']['displayName']}}</span>
                      <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                        <li class="w3-small">Area: {{report['createdBy']['area']['name']}}</li>
                      </ul>
                    </div>
                  </div>
                  <div class="w3-row">
                    <div class="w3-col s6 ms-header-mobile">OT</div>
                    <div class="w3-col s6" style="padding: 0.5em 0.5em">
                      <span class="w3-small">{{report['OT']}}</span>
                    </div>
                  </div>
                  <div class="w3-row">
                    <div class="w3-col s6 ms-header-mobile">Área</div>
                    <div class="w3-col s6" style="padding: 0.5em 0.5em">
                      <span class="w3-small" style="font-weight:500">{{report['area']['name']}}</span>
                      <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                        <li class="w3-small">Sup.: {{report['area']['supervisor']['displayName']}}</li>
                      </ul>
                    </div>
                  </div>
                  <div class="w3-row">
                    <div class="w3-col s6 ms-header-mobile">Descripción</div>
                    <div class="w3-col s6" style="padding: 0.5em 0.5em">
                      <span class="w3-small">{{report['description']}}</span>
                    </div>
                  </div>
                  <div class="w3-row">
                    <div class="w3-col s6 ms-header-mobile">Componente</div>
                    <div class="w3-col s6" style="padding: 0.5em 0.5em">
                      <span class="w3-small">{{report['component']}}</span>
                    </div>
                  </div>
                  <div class="w3-row">
                    <div class="w3-col s6 ms-header-mobile">Estado</div>
                    <div class="w3-col s6" style="padding: 0.5em 0.5em">
                      <span class="w3-small">{{report['status']}}</span>
                    </div>
                  </div>
                  <div class="w3-row">
                    <div class="w3-col s6 ms-header-mobile">Imagen inicial</div>
                    <div class="w3-col s6" style="padding: 0.5em 0.5em">
                      <a class="w3-medium" target="_blank" [href]="report['initialPicture']"
                        *ngIf="report['initialPicture']; else noImageLink">Ver imagen</a>
                      <ng-template #noImageLink>
                        <span class="w3-small w3-text-gray">No disponible</span>
                      </ng-template>
                    </div>
                  </div>
                  <mat-toolbar>
                    <span class="ms-fill"></span>
                    <button mat-icon-button matTooltip="Cerrar" (click)="toggleCardReport(i)">
                      <mat-icon>keyboard_arrow_up</mat-icon>
                    </button>
                  </mat-toolbar>
                </div>
              </ng-container>
            </div>
          </div>


        </div>
      </ng-template>
    </mat-tab>
    <mat-tab label="Analizar">
      <div class="w3-padding">
        <h2 class="ms-font-rubik ms-color-2b" style="font-size:1.2em">Análisis</h2>
      </div>
    </mat-tab>

    <mat-tab label="Acciones">
      <div class="w3-padding">
        <h2 class="ms-font-rubik ms-color-2b" style="font-size:1.2em">Acciones</h2>
      </div>
    </mat-tab>

    <mat-tab label="Cierre">
      <div class="w3-padding">
        <h2 class="ms-font-rubik ms-color-2b" style="font-size:1.2em">Cierre</h2>
      </div>
    </mat-tab>
  </mat-tab-group>


</div>