<div class="w3-section">
  <h1 class="ms-font-rubik ms-color-2b" style="font-size:1.5em;">
    <mat-icon style="vertical-align:middle; font-size: 30px; width:30px; height: 30px">assignment</mat-icon> Tareas
  </h1>
  <mat-divider></mat-divider>
  <div class="w3-padding">
    <h2 class="ms-font-rubik ms-color-2b" style="font-size:1.5em;">
    {{currentMonth}} {{currentYear}}</h2>

    <mat-form-field class="w3-margin-left">
      <input matInput [matDatepicker]="dateFilter" [formControl]="monthFormControl">
      <mat-datepicker-toggle matSuffix [for]="dateFilter"></mat-datepicker-toggle>
      <mat-datepicker #dateFilter startView='year' (monthSelected)="setMonthOfView($event, dateFilter)"
        disabled="false"></mat-datepicker>
      <mat-hint>
        <strong>Filtrar contenido por mes y año</strong>
      </mat-hint>
    </mat-form-field>

    <h2 class="ms-font-rubik ms-color-2b" style="font-size:1.2em">Tareas generadas por FRED</h2>
    <div class="mat-elevation-z8 w3-margin-top w3-round w3-hide-small">
      <div class="w3-amber w3-round-large" style="overflow:auto">
        <table mat-table [dataSource]="dataSourceFredTasks" matSort style="width:100%">

          <ng-container matColumnDef="index">
            <th mat-header-cell *matHeaderCellDef style="background:#eaeaea;padding: 0px 1em 0px 1em">N°</th>
            <td mat-cell *matCellDef="let fred; let i = index" style="color:#2b2b2b; padding: 0px 1em 0px 1em">
              {{i+1}}
            </td>
          </ng-container>

          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Fecha</th>
            <td mat-cell *matCellDef="let fred" class="w3-center"
              style="color:#2b2b2b; padding:0px 1em 0px 1em; border-left:1px solid lightgrey">
              <span class="w3-small" style="font-weight:500">{{fred['regDate'] | date : 'dd/MM/yyyy'}}</span><br>
              <span class="w3-small">({{fred['regDate'] | date : 'hh:mm:ss'}})</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Tipo de Observación
            </th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1em 0px 1em; border-left:1px solid lightgrey">
              <span class="w3-small">{{fred['type']}}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="observations">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; min-width:250px; border-left:1px solid lightgrey">
              Observaciones</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; min-width:250px; border-left:1px solid lightgrey">
              <ng-container *ngIf="fred['observations'], else blank">
                <ng-container *ngFor="let observation of fred['observations']">
                  <span class="w3-small" style="font-weight:500">{{observation['group']}}</span>
                  <ul style="margin-top:0px;margin-bottom:7px;padding-left:32px;">
                    <li class="w3-small" *ngFor="let item of observation['observations']">
                      {{item}}
                    </li>
                  </ul>
                </ng-container>
              </ng-container>

              <ng-template #blank>
                <span class="w3-small" style="font-weight:500">***</span>
              </ng-template>

            </td>
          </ng-container>

          <ng-container matColumnDef="initialPicture">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">Foto inicial</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">
              <a href="{{fred['initialPicture']}}" target="_blank"
                *ngIf="fred['initialPicture']; else defaultPictureTable1">
                <div style="width:200px;height:120px;padding:6px 6px">
                  <img src="{{fred['initialPicture']}}" style="max-width:100%;height:100%" class="w3-card-4">
                </div>
              </a>
              <ng-template #defaultPictureTable1>
                <div style="width:200px;height:120px;padding:6px 6px">
                  <img src="../../../assets/images/no-image.png" style="max-width:100%;height:100%" class="w3-card-4">
                </div>
              </ng-template>
            </td>
          </ng-container>

          <ng-container matColumnDef="observer">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
              Observador</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
              <span class="w3-small" style="font-weight:500">{{fred['createdBy']['displayName']}}</span>
              <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                <li class="w3-small">Area: {{fred['createdBy']['area']['name']}}</li>
                <li class="w3-small">Correo: <a
                    href="mailto:{{fred['createdBy']['email']}}">{{fred['createdBy']['email']}}</a></li>
              </ul>
            </td>
          </ng-container>

          <ng-container matColumnDef="observedArea">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; min-width:200px; border-left:1px solid lightgrey">
              Área observada</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; min-width:200px; border-left:1px solid lightgrey">
              <span class="w3-small" style="font-weight:500">{{fred['observedArea']['name']}}</span>
              <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                <li class="w3-small">Sup.: {{fred['observedArea']['supervisor']['displayName']}}</li>
              </ul>
            </td>
          </ng-container>

          <ng-container matColumnDef="staffObserved">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
              Personal observado</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; min-width:230px; border-left:1px solid lightgrey">
              <span class="w3-small" style="font-weight:500">{{fred['observedStaff']['displayName']}}</span>
              <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                <li class="w3-small">Área: {{fred['observedStaff']['area']['name']}}</li>
                <li class="w3-small">Correo: <a
                    href="mailto:{{fred['observedStaff']['email']}}">{{fred['observedStaff']['email']}}</a></li>
              </ul>
            </td>
          </ng-container>

          <ng-container matColumnDef="eventDescription">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">Descripción</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey; min-width:200px">
              <span class="w3-small" *ngIf="fred['substandardAct']">{{fred['substandardAct']}}</span>
              <span class="w3-small" *ngIf="fred['substandardCondition']">{{fred['substandardCondition']}}</span>
              <span class="w3-small" *ngIf="fred['remarkableAct']">{{fred['remarkableAct']}}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="upgradeOpportunity">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">Mejora</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey; min-width:200px">
              <span class="w3-small">{{fred['upgradeOpportunity']}}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">Estado</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">
              <span class="w3-small">{{fred['status']}}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="percent">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">Porcentaje</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">
              {{fred['percent']}} %
            </td>
          </ng-container>

          <ng-container matColumnDef="terminationDates">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">Fecha propuesta /
              Fecha cierre</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">
              <p class="w3-small" *ngIf="fred['estimatedTerminationDate'] === 0">**/**/****</p>
              <p class="w3-small" *ngIf="fred['estimatedTerminationDate'] > 0">
                {{(fred['estimatedTerminationDate']) | date: 'dd/MM/yyyy'}}</p>
              <p class="w3-small" *ngIf="fred['realTerminationDate'] === 0">**/**/****</p>
              <p class="w3-small" *ngIf="fred['realTerminationDate'] > 0">
                {{(fred['realTerminationDate']) | date: 'dd/MM/yyyy'}}</p>
            </td>
          </ng-container>

          <ng-container matColumnDef="finalPicture">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">Foto Levantamiento
            </th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">
              <a href="{{fred['finalPicture']}}" target="_blank"
                *ngIf="fred['finalPicture']; else defaultPictureTable1">
                <div style="width:200px;height:120px;padding:6px 6px">
                  <img src="{{fred['finalPicture']}}" style="max-width:100%;height:100%" class="w3-card-4">
                </div>
              </a>
              <ng-template #defaultPictureTable1>
                <div style="width:200px;height:120px;padding:6px 6px">
                  <img src="../../../assets/images/no-image.png" style="max-width:100%;height:100%" class="w3-card-4">
                </div>
              </ng-template>
            </td>
          </ng-container>

          <ng-container matColumnDef="edit" stickyEnd>
            <th mat-header-cell *matHeaderCellDef
              style="background:#eaeaea;padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">Acciones</th>
            <td mat-cell *matCellDef="let fred"
              style="color:#2b2b2b; padding:0px 1.5em 0px 1em; border-left:1px solid lightgrey">
              <button mat-raised-button color="primary" class="w3-margin-top w3-margin-bottom"
                matTooltip="Registrar avance"
                [disabled]="auth.userCRC.uid != fred['observedStaff']['uid'] || fred['status'] === 'Rechazado'"
                (click)="saveProgressOnTask(fred)">
                <mat-icon>check_circle</mat-icon> Finalizar
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsFredTasks; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsFredTasks;"></tr>

        </table>
      </div>
      <mat-paginator class="w3-round-large" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
    </div>

    <!-- MOBIL VERSION FREDS-->
    <div class="w3-hide-large w3-hide-medium">
      <ng-container *ngFor="let fred of filteredFredsTasks; let i = index">
        <div [@openCloseCard]="isOpenFred[i] ? 'open': 'closed'" (click)="toggleCardFred(i)"
          class="mat-elevation-z8 ms-hero-image w3-display-container w3-round-large"
          [ngStyle]="{'background-image': fred['initialPicture'] ? ('url(' + fred['initialPicture'] + ')') : 'url(../../../assets/images/no-image-mobile.jpeg)'}">
          <div class="w3-display-topright"
            style="background:rgba(0,0,0,0.8); border-radius: 0px 10px; padding: 0px 8px">
            <p style="font-size:1em; color:white"><strong>{{fred['percent']}} %</strong></p>
          </div>
          <div [@openCloseDescription]="isOpenFred[i] ? 'openDescription': 'closedDescription'"
            class="w3-display-bottomleft w3-padding" style="background:rgba(0,0,0,0.8)">
            <p style="font-weight:400; color:white; margin: 0px 0.1em">
              {{(fred['upgradeOpportunity'].length>25 ? (fred['upgradeOpportunity'] | slice:0:25)+'...':(fred['upgradeOpportunity']))}}
            </p>
            <p style="font-weight:300; color:white; margin: 0px 0.1em; font-size:0.9m"
              *ngIf="fred['estimatedTerminationDate'] != 0">
              {{fred['estimatedTerminationDate'] | date : 'dd-MM-yy'}}</p>
            <p style="font-weight:300; color:white; margin: 0px 0.1em; font-size:0.9m"
              *ngIf="fred['estimatedTerminationDate'] === 0">Por confirmar</p>
          </div>
        </div>
        <div [@openCloseContent]="isOpenFred[i] ? 'openContent': 'closedContent'" class="mat-elevation-z8">
          <mat-toolbar style="background:#333333">
            <span class="ms-fill"></span>
            <button mat-icon-button style="color:white" matTooltip="Finalizar FRED" (click)="saveProgressOnTask(fred)">
              <mat-icon>check_circle</mat-icon>
            </button>
          </mat-toolbar>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Fecha</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span>{{fred['regDate'] | date : 'dd/MM/yyy'}}</span><br>
              <span class="w3-small">{{fred['regDate'] | date : 'hh:mm:ss'}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Tipo de observación</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small">{{fred['type']}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Observaciones</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <ng-container *ngIf="fred['observations'], else blank">
                <ng-container *ngFor="let observation of fred['observations']">
                  <span class="w3-small" style="font-weight:500">{{observation['group']}}</span>
                  <ul style="margin-top:0px;margin-bottom:7px;padding-left:32px;">
                    <li class="w3-small" *ngFor="let item of observation['observations']">
                      {{item}}
                    </li>
                  </ul>
                </ng-container>
              </ng-container>

              <ng-template #blank>
                <span class="w3-small" style="font-weight:500">***</span>
              </ng-template>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Observador</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small" style="font-weight:500">{{fred['createdBy']['displayName']}}</span>
              <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                <li class="w3-small">Area: {{fred['createdBy']['area']['name']}}</li>
              </ul>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Área</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small" style="font-weight:500">{{fred['observedArea']['name']}}</span>
              <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                <li class="w3-small">Sup.: {{fred['observedArea']['supervisor']['displayName']}}</li>
              </ul>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Personal</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small" style="font-weight:500">{{fred['observedStaff']['displayName']}}</span>
              <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                <li class="w3-small">Área: {{fred['observedStaff']['area']['name']}}</li>
              </ul>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Descripción</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small" *ngIf="fred['substandardAct']">{{fred['substandardAct']}}</span>
              <span class="w3-small" *ngIf="fred['substandardCondition']">{{fred['substandardCondition']}}</span>
              <span class="w3-small" *ngIf="fred['remarkableAct']">{{fred['remarkableAct']}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Oportunidad de mejora</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small">{{fred['upgradeOpportunity']?fred['upgradeOpportunity']:'---'}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Estado</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small">{{fred['status']}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Porcentaje</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small">{{fred['percent']}} %</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Fecha propuesta</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <p class="w3-small" *ngIf="fred['estimatedTerminationDate'] === 0">**/**/****</p>
              <p class="w3-small" *ngIf="fred['estimatedTerminationDate'] > 0">
                {{(fred['estimatedTerminationDate']) | date: 'dd/MM/yyyy'}}</p>
              <p class="w3-small" *ngIf="fred['realTerminationDate'] === 0">**/**/****</p>
              <p class="w3-small" *ngIf="fred['realTerminationDate'] > 0">
                {{(fred['realTerminationDate']) | date: 'dd/MM/yyyy'}}</p>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Imagen inicial</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <a class="w3-medium" target="_blank" [href]="fred['initialPicture']"
                *ngIf="fred['initialPicture']; else noImageLink">Ver imagen</a>
              <ng-template #noImageLink>
                <span class="w3-small w3-text-gray">No disponible</span>
              </ng-template>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Imagen levantamiento</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <a class="w3-medium" target="_blank" [href]="fred['finalPicture']"
                *ngIf="fred['finalPicture']; else noImageLink">Ver imagen</a>
              <ng-template #noImageLink>
                <span class="w3-small w3-text-gray">No disponible</span>
              </ng-template>
            </div>
          </div>
          <mat-toolbar>
            <span class="ms-fill"></span>
            <button mat-icon-button matTooltip="Cerrar" (click)="toggleCardFred(i)">
              <mat-icon>keyboard_arrow_up</mat-icon>
            </button>
          </mat-toolbar>
        </div>
      </ng-container>
    </div>

    <div *ngIf="!filteredFredsTasks.length"
      class="w3-container w3-center w3-hide-large w3-hide-medium ms-empty-container w3-round-large mat-elevation-z8">
      <h2 class="ms-empty-list">
        Sin novedades
      </h2>
    </div>

    <h2 class="ms-font-rubik ms-color-2b" style="font-size:1.2em">Tareas generadas por Inspección</h2>
    <div class="mat-elevation-z8 w3-margin-top w3-round w3-hide-small">
      <div class="w3-amber w3-round-large" style="overflow:auto">
        <table mat-table [dataSource]="dataSourceInspectionTasks" matSort style="width:100%">

          <ng-container matColumnDef="index">
            <th mat-header-cell *matHeaderCellDef
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">N°</th>
            <td mat-cell *matCellDef="let observation; let i = index"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey">
              {{i+1}}
            </td>
          </ng-container>

          <ng-container matColumnDef="kindOfDanger">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Clase de Peligro</th>
            <td mat-cell *matCellDef="let observation" class="w3-small"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey">
              {{observation['kindOfDanger']}}
            </td>
          </ng-container>

          <ng-container matColumnDef="kindOfObservation">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Tipo de Observación
            </th>
            <td mat-cell *matCellDef="let observation" class="w3-small"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey">
              {{observation['kindOfObservation']}}
            </td>
          </ng-container>

          <ng-container matColumnDef="observationDescription">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey;min-width:230px">
              Descripción de la observación (Condición / Acto Subestándar)</th>
            <td mat-cell *matCellDef="let observation" class="w3-small"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey;min-width:230px">
              {{observation['observationDescription']}}
            </td>
          </ng-container>

          <ng-container matColumnDef="initialPicture">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Foto</th>
            <td mat-cell *matCellDef="let observation" class="w3-small"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey">
              <a href="{{observation['initialPicture']}}" target="_blank">
                <div style="width:200px;height:120px;padding:6px 6px">
                  <img src="{{observation['initialPicture']}}" style="max-width:100%;height:100%" class="w3-card-4">
                </div>
              </a>
            </td>
          </ng-container>

          <ng-container matColumnDef="cause">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Causa</th>
            <td mat-cell *matCellDef="let observation" class="w3-small"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey">
              {{observation['cause']}}
            </td>
          </ng-container>

          <ng-container matColumnDef="recommendationDescription">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey;min-width:230px">
              Conclusiones / Recomendaciones / Medidas Correctivas</th>
            <td mat-cell *matCellDef="let observation" class="w3-small"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey;min-width:230px">
              {{observation['recommendationDescription']}}
            </td>
          </ng-container>

          <ng-container matColumnDef="area">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey;min-width:230px">Área
            </th>
            <td mat-cell *matCellDef="let observation" class="w3-small"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey;min-width:230px">
              <span style="font-weight:500">{{observation['area']['name']}}</span>
              <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                <li>Sup.: {{observation['area']['supervisor']['displayName']}}</li>
              </ul>
            </td>
          </ng-container>

          <ng-container matColumnDef="terminationDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Fecha de Termino /
              Fecha Realización</th>
            <td mat-cell *matCellDef="let observation"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey">
              <p class="w3-small" *ngIf="observation['estimatedTerminationDate'] === 0">**/**/****</p>
              <p class="w3-small" *ngIf="observation['estimatedTerminationDate'] > 0">
                {{(observation['estimatedTerminationDate']) | date: 'dd/MM/yyyy'}}</p>
              <p class="w3-small" *ngIf="observation['realTerminationDate'] === 0">**/**/****</p>
              <p class="w3-small" *ngIf="observation['realTerminationDate'] > 0">
                {{(observation['realTerminationDate']) | date: 'dd/MM/yyyy'}}</p>
            </td>
          </ng-container>

          <ng-container matColumnDef="percent">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Porcentaje</th>
            <td mat-cell *matCellDef="let observation" class="w3-small"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey">
              {{observation['percent']}} %
            </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Estado</th>
            <td mat-cell *matCellDef="let observation" class="w3-small"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey">
              {{observation['status']}}
            </td>
          </ng-container>

          <ng-container matColumnDef="finalPicture">
            <th mat-header-cell *matHeaderCellDef mat-sort-header
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Foto Levantamiento
            </th>
            <td mat-cell *matCellDef="let observation" class="w3-small"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey">
              <a href="{{observation['finalPicture']}}" target="_blank"
                *ngIf="observation['finalPicture']; else defaultPictureTable2">
                <div style="width:200px;height:120px;padding:6px 6px">
                  <img src="{{observation['finalPicture']}}" style="max-width:100%;height:100%" class="w3-card-4">
                </div>
              </a>
              <ng-template #defaultPictureTable2>
                <div style="width:200px;height:120px;padding:6px 6px">
                  <img src="../../../assets/images/no-image.png" style="max-width:100%;height:100%" class="w3-card-4">
                </div>
              </ng-template>
            </td>
          </ng-container>

          <ng-container matColumnDef="edit" stickyEnd>
            <th mat-header-cell *matHeaderCellDef
              style="background:#f7f7f7;padding:0px 1em 0px 1em; border-left:1px solid lightgrey">Acciones</th>
            <td mat-cell *matCellDef="let observation"
              style="color:#2b2b2b; padding:1em 1em 0px 1em; border-left:1px solid lightgrey">
              <button mat-raised-button color="primary" class="w3-margin-top w3-margin-bottom"
                matTooltip="Finalizar tarea" (click)="saveProgressOnObservation(observation)"
                [disabled]="observation['status'] === 'Rechazado'">
                <mat-icon>check_circle</mat-icon> Finalizar
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsInspectionTasks; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsInspectionTasks;"></tr>

        </table>
      </div>
      <mat-paginator class="w3-round-large" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
    </div>

    <!-- MOBIL VERSION OBSERVATIONS-->
    <div class="w3-hide-large w3-hide-medium">
      <ng-container *ngFor="let observation of filteredObservationsTasks; let i = index">
        <div id="observation_{{i}}" [@openCloseCard]="isOpenObservation[i] ? 'open': 'closed'"
          (click)="toggleCardObservation(i)" class="mat-elevation-z8 ms-hero-image w3-display-container w3-round-large"
          [ngStyle]="{'background-image': observation['initialPicture'] ? ('url(' + observation['initialPicture'] + ')') : 'url(../../../assets/images/no-image-mobile.jpeg)'}">
          <div class="w3-display-topright"
            style="background:rgba(0,0,0,0.8); border-radius: 0px 10px; padding: 0px 8px">
            <p style="font-size:1em; color:white"><strong>{{observation['percent']}} %</strong></p>
          </div>
          <div [@openCloseDescription]="isOpenObservation[i] ? 'openDescription': 'closedDescription'"
            class="w3-display-bottomleft w3-padding" style="background:rgba(0,0,0,0.8)">
            <p style="font-weight:400; color:white; margin: 0px 0.1em">
              {{(observation['recommendationDescription'].length>25 ? (observation['recommendationDescription'] | slice:0:25)+'...':(observation['recommendationDescription']))}}
            </p>
            <p style="font-weight:300; color:white; margin: 0px 0.1em; font-size:0.9m"
              *ngIf="observation['estimatedTerminationDate'] != 0">
              {{observation['estimatedTerminationDate'] | date : 'dd-MM-yy'}}</p>
            <p style="font-weight:300; color:white; margin: 0px 0.1em; font-size:0.9m"
              *ngIf="observation['estimatedTerminationDate'] === 0">Por confirmar</p>
          </div>
        </div>
        <div [@openCloseContent]="isOpenObservation[i] ? 'openContent': 'closedContent'" class="mat-elevation-z8">
          <mat-toolbar style="background:#333333">
            <span class="ms-fill"></span>
            <button mat-icon-button style="color:white" matTooltip="Editar Observación"
              (click)="saveProgressOnObservation(observation)">
              <mat-icon>check_circle</mat-icon>
            </button>
          </mat-toolbar>

          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Clase de peligro</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small">{{observation['kindOfDanger']}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Tipo de observación</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small">{{observation['kindOfObservation']}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Descripción de la obsrvación</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small">{{observation['observationDescription']}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Causa</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small">{{observation['cause']}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Conclusiones / Recomendaciones / Medidas correctivas</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small">{{observation['recommendationDescription']}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Área</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small" style="font-weight:500">{{observation['area']['name']}}</span>
              <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                <li class="w3-small">Sup.: {{observation['area']['supervisor']['displayName']}}</li>
              </ul>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Área</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small" style="font-weight:500">{{observation['area']['name']}}</span>
              <ul style="margin-top:0px;margin-bottom:7px;padding-left:16px;">
                <li class="w3-small">Sup.: {{observation['area']['supervisor']['displayName']}}</li>
              </ul>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Fecha propuesta / Fecha realización</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span matTooltip="Fecha propuesta" class="w3-small"
                *ngIf="observation['estimatedTerminationDate'] === 0">**/**/****</span>
              <span matTooltip="Fecha propuesta" class="w3-small" *ngIf="observation['estimatedTerminationDate'] > 0">
                {{(observation['estimatedTerminationDate']) | date: 'dd/MM/yyyy'}}</span><br>
              <span matTooltip="Fecha realizada" class="w3-small"
                *ngIf="observation['realTerminationDate'] === 0">**/**/****</span>
              <span matTooltip="Fecha realizada" class="w3-small" *ngIf="observation['realTerminationDate'] > 0">
                {{(observation['realTerminationDate']) | date: 'dd/MM/yyyy'}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Porcentaje de avance</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small" style="font-weight:500">{{observation['percent']}} %</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Estado</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <span class="w3-small" style="font-weight:500">{{observation['status']}}</span>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Foto inicial</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <a class="w3-medium" target="_blank" [href]="observation['initialPicture']">ver imagen</a>
            </div>
          </div>
          <div class="w3-row">
            <div class="w3-col s6 ms-header-mobile">Foto final</div>
            <div class="w3-col s6" style="padding: 0.5em 0.5em">
              <a class="w3-medium" target="_blank" [href]="observation['finalPicture']">ver imagen</a>
            </div>
          </div>

          <div style="display:flex; justify-content: center; background:#c5c5c5">
            <button mat-icon-button class="w3-text-white" (click)="toggleCardObservation(i)"><a
                href="#observation_{{inspectionIndex}}"></a>
              <mat-icon>keyboard_arrow_up</mat-icon>
            </button>
          </div>
        </div>
      </ng-container>
    </div>

    <div *ngIf="!filteredObservationsTasks.length"
      class="w3-container w3-center w3-hide-large w3-hide-medium ms-empty-container w3-round-large mat-elevation-z8">
      <h2 class="ms-empty-list">
        Sin novedades
      </h2>
    </div>

  </div>
</div>